<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <title>Matrícula Colegio</title>
  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- FontAwesome -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <!-- Flatpickr (datepicker moderno) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <style>
    body {
      font-family: 'Roboto', sans-serif;
      background: linear-gradient(135deg, #6dd5ed, #2193b0);
      min-height: 100vh;
    }

    header {
      text-align: center;
      padding: 2rem;
      color: white;
      background: rgba(0, 0, 0, 0.3);
      border-bottom: 2px solid rgba(255, 255, 255, 0.2);
    }

    header img {
      max-height: 80px;
      margin-bottom: 10px;
    }

    .form-container {
      background: white;
      border-radius: 20px;
      padding: 2rem 3rem;
      margin: 2rem auto;
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
      animation: fadeInUp 1s ease;
    }

    .form-container h2 {
      text-align: center;
      margin-bottom: 2rem;
      font-weight: bold;
      color: #333;
    }

    .step h3 {
      margin-bottom: 1rem;
      color: #0d6efd;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(50px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Estilo más elegante para Flatpickr */
    .flatpickr-calendar {
      border-radius: 12px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.25);
    }

    .flatpickr-day.today {
      background: #0d6efd;
      color: white;
      border-radius: 50%;
    }

    .flatpickr-day.selected {
      background: #198754 !important;
      color: white;
      border-radius: 50%;
    }
  </style>
</head>

<body>
  <!-- Cabecera -->
  <header>
    <img src="imagenes/logocolegio.png" alt="Logo Colegio">
    <h1 class="fw-bold">I.E.E JOSE GRANDA</h1>
  </header>

  <!-- Contenedor principal -->
  <div class="container">
    <div class="col-lg-8 col-md-10 form-container">
      <h2><i class="fas fa-clipboard-list"></i> Formulario de Matrícula</h2>

      <form action="guardar_matricula.php" method="POST" enctype="multipart/form-data" class="needs-validation" novalidate>

        <!-- Información del Padre -->
        <div class="step mb-4">
          <h3><i class="fas fa-user"></i> Información del Padre</h3>
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label">Nombre</label>
              <input type="text" name="padre_nombre" class="form-control" required>
            </div>
            <div class="col-md-6">
              <label class="form-label">Apellido</label>
              <input type="text" name="padre_apellido" class="form-control" required>
            </div>
            <div class="col-md-6">
              <label class="form-label">DNI</label>
              <input type="text" name="padre_dni" class="form-control" required>
            </div>
            <div class="col-md-6">
              <label class="form-label">Teléfono</label>
              <input type="text" name="padre_telefono" class="form-control">
            </div>
            <div class="col-md-12">
              <label class="form-label">Correo</label>
              <input type="email" name="padre_correo" class="form-control">
            </div>
          </div>
        </div>

        <!-- Información del Alumno -->
        <div class="step mb-4">
          <h3><i class="fas fa-user-graduate"></i> Información del Alumno</h3>
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label">Nombre</label>
              <input type="text" name="alumno_nombre" class="form-control" required>
            </div>
            <div class="col-md-6">
              <label class="form-label">Apellido</label>
              <input type="text" name="alumno_apellido" class="form-control" required>
            </div>
            <div class="col-md-6">
              <label class="form-label">DNI</label>
              <input type="text" name="alumno_dni" class="form-control">
            </div>
            <div class="col-md-6">
              <label class="form-label">Fecha de Nacimiento</label>
              <input type="text" id="alumno_fecha" name="alumno_fecha" class="form-control" placeholder="Selecciona fecha">
            </div>
          </div>
        </div>

        <!-- Matrícula -->
        <div class="step mb-4">
          <h3><i class="fas fa-school"></i> Matrícula</h3>
          <label class="form-label">Grado</label>
          <select name="grado" class="form-select" id="grado" required>
            <option value="">-- Seleccione grado --</option>
            <option value="1">1ro de Secundaria</option>
            <option value="2">2do de Secundaria</option>
            <option value="3">3ro de Secundaria</option>
            <option value="4">4to de Secundaria</option>
            <option value="5">5to de Secundaria</option>
          </select>
        </div>

        <!-- Talleres -->
        <div class="step mb-4">
          <h3><i class="fas fa-futbol"></i> Talleres Opcionales</h3>
          <label class="form-label">Seleccione Taller</label>
          <select id="taller" name="taller" class="form-select" onchange="mostrarVoucher()">
            <option value="">No se inscribió a ningún taller</option>
            <option value="1" data-precio="120">Fútbol - S/120</option>
            <option value="2" data-precio="100">Danza - S/100</option>
            <option value="3" data-precio="150">Computación - S/150</option>
          </select>
          <input type="hidden" name="monto_taller" id="monto_taller" value="0">

          <div id="pago" class="mt-3" style="display:none;">
            <p class="fw-bold">Monto a pagar: S/<span id="precio"></span></p>
            <div class="d-flex gap-2 flex-wrap">
              <button type="button" class="btn btn-outline-success" onclick="setPago('Yape')"><i class="fab fa-cc-apple-pay"></i> Yape</button>
              <button type="button" class="btn btn-outline-primary" onclick="setPago('Plin')"><i class="fas fa-mobile-alt"></i> Plin</button>
              <button type="button" class="btn btn-outline-warning" onclick="setPago('Efectivo')"><i class="fas fa-money-bill-wave"></i> Efectivo</button>
              <button type="button" class="btn btn-outline-danger" onclick="setPago('Tarjeta')"><i class="fas fa-credit-card"></i> Tarjeta</button>
            </div>
          </div>
        </div>

        <!-- Documentos -->
        <div class="step mb-4">
          <h3><i class="fas fa-file-upload"></i> Documentos</h3>
          <div class="mb-3">
            <label class="form-label">Recibo de Agua</label>
            <input type="file" name="recibo_agua" class="form-control">
          </div>
          <div class="mb-3">
            <label class="form-label">Recibo de Luz</label>
            <input type="file" name="recibo_luz" class="form-control">
          </div>
          <div class="mb-3">
            <label class="form-label">Notas Año Anterior</label>
            <input type="file" name="notas" class="form-control">
          </div>
        </div>

        <!-- Voucher -->
        <div class="step mb-4" id="voucher-container" style="display:none;">
          <h3><i class="fas fa-file-invoice-dollar"></i> Voucher de Pago</h3>
          <label class="form-label">Cargar Voucher</label>
          <input type="file" name="voucher_pago" id="voucher_pago" class="form-control">
        </div>

        <!-- Campo oculto -->
        <input type="hidden" name="metodo" id="metodo">

        <!-- Botón -->
        <div class="text-center">
          <button type="submit" class="btn btn-primary btn-lg px-5 shadow"><i class="fas fa-save"></i> Guardar Matrícula</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Toast Bootstrap -->
  <div class="toast-container position-fixed top-0 end-0 p-3">
    <div id="liveToast" class="toast align-items-center text-bg-success border-0" role="alert">
      <div class="d-flex">
        <div class="toast-body">
          Método de pago seleccionado.
        </div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
      </div>
    </div>
  </div>

  <!-- JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script>
    // Flatpickr para fecha de nacimiento
    flatpickr("#alumno_fecha", {
      dateFormat: "d-m-Y",
      maxDate: "today",
      locale: "es",
      altInput: true,
      altFormat: "j \\de F \\de Y"
    });

    function mostrarVoucher() {
      let select = document.getElementById("taller");
      let pago = document.getElementById("pago");
      let precio = document.getElementById("precio");
      let monto_taller = document.getElementById("monto_taller");
      let voucherContainer = document.getElementById("voucher-container");
      let voucherInput = document.getElementById("voucher_pago");

      if (select.value !== "") {
        let opcion = select.options[select.selectedIndex];
        let costo = opcion.getAttribute("data-precio");
        precio.textContent = costo;
        monto_taller.value = costo;
        pago.style.display = "block";
        voucherContainer.style.display = "block";
        voucherInput.setAttribute("required", "true");
      } else {
        precio.textContent = "";
        monto_taller.value = 0;
        pago.style.display = "none";
        voucherContainer.style.display = "none";
        voucherInput.removeAttribute("required");
        document.getElementById("metodo").value = "";
      }
    }

    function setPago(metodo) {
      document.getElementById("metodo").value = metodo;
      let toastEl = document.getElementById('liveToast');
      toastEl.querySelector('.toast-body').textContent = "Método de pago seleccionado: " + metodo;
      let toast = new bootstrap.Toast(toastEl);
      toast.show();
    }

    // Asigna la fecha actual de matrícula antes de enviar el formulario
    document.querySelector("form").onsubmit = function() {
      var fechaMatricula = document.createElement("input");
      fechaMatricula.type = "hidden";
      fechaMatricula.name = "fecha_matricula";
      fechaMatricula.value = new Date().toISOString().slice(0, 10);  // Obtiene la fecha actual en formato YYYY-MM-DD
      this.appendChild(fechaMatricula);  // Agrega el campo hidden al formulario
    };
  </script>
</body>

</html>
